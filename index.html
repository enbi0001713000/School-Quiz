<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0b3a79" />
  <title>義務教育 5教科クイズ</title>

  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">Q</div>
      <div class="brandText">
        <div class="title">義務教育 5教科クイズ</div>
        <div class="subtitle">国数英理社 / 25問（各5問）・難易度タグ対応・結果分析＆レーダー・履歴（この端末）</div>
      </div>
    </div>

    <div class="topActions">
      <button id="btnHistoryTop" class="btn ghost" type="button">履歴</button>
      <button id="btnNew" class="btn" type="button" disabled>新しいクイズ</button>
      <button id="btnReset" class="btn ghost" type="button" disabled>解答リセット</button>
      <button id="btnGrade" class="btn primary" type="button" disabled>採点して結果へ</button>
    </div>
  </header>

  <main class="page">
    <!-- Unlock -->
    <section id="unlockCard" class="card">
      <h2>合言葉でロック解除</h2>
      <p class="muted">
        公開リンクで遊べる版です。合言葉を入力すると開始できます（合言葉はソースに露出しにくい形で管理）。
      </p>
      <div class="row">
        <input id="passInput" class="input" type="password" inputmode="numeric" placeholder="合言葉を入力" />
        <button id="btnUnlock" class="btn primary" type="button">ロック解除</button>
      </div>
      <!-- ★ヒント表示は“出さない”仕様（削除済み） -->
    </section>

    <!-- Filters -->
    <section id="filterCard" class="card" style="display:none;">
      <h2>出題フィルタ（タグ）</h2>
      <p class="muted">難易度や学年帯のバランスを調整できます（未選択は全対象）。</p>

      <div class="grid2">
        <div class="panel">
          <div class="panelTitle">学年帯</div>
          <label class="chk"><input id="chkGradeE" type="checkbox" checked /> 小</label>
          <label class="chk"><input id="chkGradeJ" type="checkbox" checked /> 中</label>
        </div>

        <div class="panel">
          <div class="panelTitle">難易度</div>
          <label class="chk"><input id="chkDiffB" type="checkbox" checked /> 基礎</label>
          <label class="chk"><input id="chkDiffN" type="checkbox" checked /> 標準</label>
          <label class="chk"><input id="chkDiffA" type="checkbox" checked /> 発展</label>
        </div>
      </div>

      <div class="row wrap">
        <label class="chk"><input id="chkAvoidSimilar" type="checkbox" checked /> 似たパターンの連発を避ける（おすすめ）</label>
        <label class="chk"><input id="chkNoDup" type="checkbox" checked /> 25問内の問題かぶり禁止（おすすめ）</label>
      </div>

      <div class="muted small">
        ※問題が不足する場合は、条件を自動で緩めて（フォールバック）出題します。
      </div>
    </section>

    <!-- Quiz -->
    <section id="viewQuiz" class="card" style="display:none;">
      <div class="quizHeader">
        <div>
          <div id="qNo" class="qNo">Q1 / 25</div>
          <div id="qChips" class="chips"></div>
        </div>
        <div class="elapsedBox">
          <div class="muted small">この問題の経過</div>
          <div id="qElapsed" class="elapsed">0.0s</div>
        </div>
      </div>

      <div id="qText" class="qText">ここに問題文</div>

      <div id="choices" class="choices"></div>

      <div class="quizFooter">
        <button id="btnPrev" class="btn ghost" type="button">前へ</button>
        <div class="spacer"></div>
        <button id="btnNext" class="btn primary" type="button">次へ</button>
      </div>

      <div class="progressWrap">
        <div class="progressBar">
          <div id="progressFill" class="progressFill" style="width:0%"></div>
        </div>
      </div>
    </section>

    <!-- Result -->
    <section id="viewResult" class="card" style="display:none;">
      <h2>結果</h2>

      <div id="resultSummary" class="resultSummary"></div>

      <div class="grid2">
        <div class="panel">
          <div class="panelTitle">分析（自動）</div>
          <pre id="analysisText" class="analysis"></pre>
        </div>

        <div class="panel">
          <div class="panelTitle">教科別（レーダー）</div>
          <canvas id="radarCanvas" class="canvas"></canvas>
        </div>
      </div>

      <div id="breakdown"></div>

      <div class="panel">
        <div class="panelTitle">解説（問題番号を押す）</div>
        <div id="explainList" class="miniBtns"></div>
        <div id="explainBox" class="explainBox" style="display:none;"></div>
      </div>

      <div class="panel">
        <div class="row">
          <div class="panelTitle">履歴（この端末）</div>
          <div class="spacer"></div>
          <button id="btnToggleHistory" class="btn ghost" type="button">履歴を表示</button>
          <button id="btnClearHistory" class="btn ghost danger" type="button">履歴を全削除</button>
        </div>

        <div id="historyPanel" style="display:none;">
          <div id="historyStats" class="historyStats"></div>
          <div class="panelTitle">最近10回の推移</div>
          <canvas id="historyCanvas" class="canvas"></canvas>
          <div class="panelTitle">直近一覧（最大10件）</div>
          <div id="historyList" class="historyList"></div>
        </div>
      </div>

      <div class="muted small">
        ※オフライン対応（Service Worker）。反映されない場合は強制リロード（Ctrl+Shift+R）またはサイトデータ削除、必要なら sw.js の CACHE_NAME を v+1 してください。
      </div>
    </section>
  </main>

  <script src="bank.js"></script>
  <script src="app.js"></script>
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./sw.js").catch(() => {});
    }
  </script>
</body>
</html>

