<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0b3a79" />
  <title>義務教育 5教科クイズ（25問）</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="favicon.ico" />

  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <!-- Top Bar -->
  <div class="topbar">
    <div class="brand">
      <div class="logo">Q</div>
      <div class="brandText">
        <div class="title">義務教育 5教科クイズ（25問）</div>
        <div class="subtitle">学習×自己分析（履歴・レーダー）</div>
      </div>
    </div>

    <div class="topActions">
      <button id="btnHistoryTop" class="btn ghost" type="button">履歴</button>
      <button id="btnNew" class="btn primary" type="button">新しいクイズ</button>
      <button id="btnReset" class="btn" type="button">リセット</button>
      <button id="btnGrade" class="btn" type="button">採点</button>
    </div>
  </div>

  <main class="page">

    <!-- Unlock -->
    <section id="unlockCard" class="card" style="display:none;">
      <h2>ロック解除</h2>
      <div class="muted small">合言葉を入力するとクイズを開始できます。</div>
      <div class="row wrap" style="margin-top:12px;">
        <input id="passInput" class="input" type="password" inputmode="numeric" placeholder="合言葉" />
        <button id="btnUnlock" class="btn primary" type="button">解除</button>
      </div>
    </section>

    <!-- Filters -->
    <section id="filterCard" class="card" style="display:none;">
      <h2>出題フィルタ</h2>
      <div class="grid2" style="margin-top:10px;">
        <div class="panel">
          <div class="panelTitle">学年</div>
          <label class="chk"><input id="chkGradeE" type="checkbox" checked /> 小</label>
          <label class="chk"><input id="chkGradeJ" type="checkbox" checked /> 中</label>
        </div>

        <div class="panel">
          <div class="panelTitle">難易度</div>
          <label class="chk"><input id="chkDiffB" type="checkbox" checked /> 基礎</label>
          <label class="chk"><input id="chkDiffN" type="checkbox" checked /> 標準</label>
          <label class="chk"><input id="chkDiffA" type="checkbox" checked /> 発展</label>
        </div>
      </div>
    </section>

    <!-- Quiz View -->
    <section id="viewQuiz" class="card" style="display:none;">
      <div class="quizHeader">
        <div>
          <div id="qNo" class="qNo">Q1 / 25</div>
          <div id="qChips" class="chips"></div>
        </div>
        <div class="elapsedBox">
          <div class="muted small">この問題の経過</div>
          <div id="qElapsed" class="elapsed">0.0s</div>
        </div>
      </div>

      <div id="qText" class="qText"></div>

      <div id="choices" class="choices"></div>

      <div class="quizFooter">
        <button id="btnPrev" class="btn" type="button">前へ</button>
        <button id="btnNext" class="btn" type="button">次へ</button>
        <div class="spacer"></div>
        <div class="muted small">※ 採点後は選択できません</div>
      </div>

      <div class="progressWrap">
        <div class="progressBar"><div id="progressFill" class="progressFill" style="width:4%;"></div></div>
      </div>
    </section>

    <!-- Result View -->
    <section id="viewResult" class="card" style="display:none;">
      <h2>結果</h2>

      <div id="resultSummary" class="resultSummary" style="margin-top:10px;"></div>

      <div class="grid2" style="margin-top:14px;">
        <div class="panel">
          <div class="panelTitle">レーダー（教科別正答率）</div>
          <canvas id="radarCanvas" class="canvas"></canvas>
        </div>
        <div class="panel">
          <div class="panelTitle">分析</div>
          <pre id="analysisText" class="analysis"></pre>
        </div>
      </div>

      <div id="breakdown" style="margin-top:14px;"></div>

      <div class="panel" style="margin-top:14px;">
        <div class="panelTitle">解説（番号を押すと表示）</div>
        <div id="explainList" class="miniBtns"></div>
        <div id="explainBox" class="explainBox" style="display:none;"></div>
      </div>

      <div class="panel" style="margin-top:14px;">
        <div class="row wrap">
          <div class="panelTitle" style="margin:0;">履歴</div>
          <div class="spacer"></div>
          <button id="btnToggleHistory" class="btn ghost" type="button">開閉</button>
          <button id="btnClearHistory" class="btn danger" type="button">履歴全削除</button>
        </div>

        <div id="historyPanel" style="display:none; margin-top:12px;">
          <div id="historyStats" class="historyStats"></div>
          <canvas id="historyCanvas" class="canvas" style="height:220px;"></canvas>
          <div id="historyList" class="historyList" style="margin-top:12px;"></div>
        </div>
      </div>
    </section>

  </main>

  <!-- Scripts -->
  <script src="bank.js"></script>
  <script src="app.js"></script>

  <!-- Service Worker -->
  <script>
    (function () {
      if (!("serviceWorker" in navigator)) return;
      window.addEventListener("load", async () => {
        try {
          await navigator.serviceWorker.register("./sw.js");
        } catch (e) {
          console.warn("[SW] register failed:", e);
        }
      });
    })();
  </script>
</body>
</html>

