:root{
  --bg:#fbf7ef;
  --card:#ffffff;
  --surface:#ffffff;
  --surface-muted:#f2efe7;
  --surface-alt:#fbf8f1;
  --action-bg:#f2efe7;
  --action-text:var(--text);
  --text:#0c1b2a;
  --muted:#5c6775;
  --border:rgba(0,0,0,0.10);
  --primary:#0b3a79;
  --primary2:#1f5fb8;
  --danger:#b42318;
  --shadow:0 10px 26px rgba(0,0,0,0.06);
  --radius:18px;
  --topbar-bg:rgba(251,247,239,0.85);
  --progress-bg:#f1ede3;
  --progress-fill:linear-gradient(90deg, #0b3a79, #3b82f6);
  --ghost-bg:#ffffff;
  --logo-bg:var(--primary);
  --logo-text:#ffffff;
  --table-border:rgba(0,0,0,0.12);
  --table-head:rgba(0,0,0,0.04);
  --mini-na-bg:rgba(0,0,0,0.06);
  --mini-na-border:rgba(0,0,0,0.18);
  --mini-na-text:rgba(0,0,0,0.55);
  --chart-grid:rgba(0,0,0,0.12);
  --chart-axis:rgba(0,0,0,0.12);
  --chart-text:rgba(0,0,0,0.72);
  --chart-guide:rgba(0,0,0,0.08);
  --chart-accent-fill:rgba(20,60,160,0.18);
  --chart-accent-stroke:rgba(20,60,160,0.55);
  --chart-line:rgba(20,60,160,0.65);
  --chart-point:rgba(20,60,160,0.75);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", "Noto Sans JP", sans-serif;
  background:var(--bg);
  color:var(--text);
}

:root[data-theme="dark"]{
  --bg:#0a1330;
  --card:#0f1b3f;
  --surface:#101f46;
  --surface-muted:#1f3572;
  --surface-alt:#1c2f66;
  --action-bg:#3559c7;
  --action-text:#f5f7ff;
  --text:#f5f7ff;
  --muted:#b3c2e6;
  --border:rgba(255,255,255,0.16);
  --primary:#4f7dff;
  --primary2:#7aa2ff;
  --danger:#ff7070;
  --shadow:0 12px 28px rgba(0,0,0,0.45);
  --topbar-bg:rgba(11,19,48,0.85);
  --progress-bg:#132351;
  --progress-fill:var(--action-bg);
  --ghost-bg:var(--action-bg);
  --logo-bg:#ffffff;
  --logo-text:#0a1330;
  --table-border:rgba(255,255,255,0.2);
  --table-head:rgba(255,255,255,0.08);
  --mini-na-bg:rgba(255,255,255,0.08);
  --mini-na-border:rgba(255,255,255,0.18);
  --mini-na-text:rgba(255,255,255,0.7);
  --chart-grid:rgba(255,255,255,0.2);
  --chart-axis:rgba(255,255,255,0.2);
  --chart-text:rgba(245,247,255,0.9);
  --chart-guide:rgba(255,255,255,0.12);
  --chart-accent-fill:rgba(110,151,255,0.25);
  --chart-accent-stroke:rgba(110,151,255,0.8);
  --chart-line:rgba(110,151,255,0.85);
  --chart-point:rgba(110,151,255,0.9);
}

.topbar{
  position:sticky;
  top:0;
  z-index:10;
  background:var(--topbar-bg);
  backdrop-filter: blur(10px);
  border-bottom:1px solid var(--border);
  padding:14px 18px;
  display:flex;
  gap:14px;
  align-items:center;
  justify-content:space-between;
}

.brand{display:flex;gap:12px;align-items:center}
.logo{
  width:44px;height:44px;border-radius:14px;
  background:var(--logo-bg);
  color:var(--logo-text);
  display:grid;place-items:center;
  font-weight:800;
}
.brandText .title{font-weight:800;font-size:18px;line-height:1.1}
.brandText .subtitle{color:var(--muted);font-size:12px;margin-top:2px}

.topActions{display:flex;gap:10px;flex-wrap:wrap}

.page{
  max-width:1100px;
  margin:18px auto 60px;
  padding:0 18px;
  display:flex;
  flex-direction:column;
  gap:18px;
}

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:20px;
}

h2{margin:0 0 10px 0}
.muted{color:var(--muted)}
.small{font-size:12px}
.row{display:flex;gap:10px;align-items:center}
.row.wrap{flex-wrap:wrap}
.spacer{flex:1}

.input{
  width: min(680px, 100%);
  padding:12px 14px;
  border-radius:14px;
  border:1px solid var(--border);
  background:var(--surface);
  font-size:16px;
}

.btn{
  padding:12px 14px;
  border-radius:14px;
  border:1px solid var(--border);
  background:var(--action-bg);
  cursor:pointer;
  font-weight:700;
  color:var(--action-text);
}
.btn:hover{filter:brightness(0.98)}
.btn:active{transform:translateY(1px)}
.btn.primary{
  background: linear-gradient(180deg, var(--primary2), var(--primary));
  border-color:rgba(0,0,0,0.08);
  color:#fff;
}
:root[data-theme="dark"] .btn.primary{
  background:#ffffff;
  color:#0a1330;
  border-color:rgba(255,255,255,0.65);
}
.btn.ghost{
  background:var(--ghost-bg);
}
.btn.danger{
  color:var(--danger);
  border-color: rgba(180, 35, 24, 0.25);
}
.btn:disabled{
  opacity:0.55;
  cursor:not-allowed;
}

.grid2{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:14px;
}
@media (max-width:820px){
  .grid2{grid-template-columns:1fr}
}

.panel{
  border:1px solid var(--border);
  border-radius:16px;
  padding:14px;
  background:var(--surface);
}
.panelTitle{
  font-weight:800;
  margin-bottom:10px;
}

.chk{display:flex;align-items:center;gap:10px;margin:8px 0}
.chk input{transform:scale(1.1)}

.quizHeader{
  display:flex;
  justify-content:space-between;
  gap:18px;
  align-items:flex-start;
}
.qNo{font-size:22px;font-weight:900;margin-bottom:8px}
.chips{display:flex;gap:8px;flex-wrap:wrap}
.chip{
  border:1px solid var(--border);
  padding:6px 10px;
  border-radius:999px;
  font-weight:700;
  font-size:13px;
  background:var(--surface);
}
.elapsedBox{text-align:right}
.elapsed{font-size:26px;font-weight:900}

.qText{
  margin-top:14px;
  font-size:22px;
  font-weight:800;
  line-height:1.45;
}

.choices{
  margin-top:14px;
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:14px;
}
@media (max-width:820px){
  .choices{grid-template-columns:1fr}
}

.choice{
  width:100%;
  display:flex;
  gap:10px;
  align-items:center;
  border:1px solid var(--border);
  border-radius:16px;
  padding:14px;
  background:var(--surface);
  cursor:pointer;
  font-weight:800;
  text-align:left;
}
.choice:hover{filter:brightness(0.99)}
.choice.selected{
  outline:3px solid rgba(31,95,184,0.22);
  border-color: rgba(31,95,184,0.35);
}
.choiceBadge{
  width:34px;height:34px;border-radius:12px;
  display:grid;place-items:center;
  border:1px solid var(--border);
  background:var(--surface-alt);
  font-weight:900;
}

.quizFooter{
  margin-top:14px;
  display:flex;
  align-items:center;
  gap:10px;
}

.progressWrap{margin-top:14px}
.progressBar{
  height:14px;
  border-radius:999px;
  background:var(--progress-bg);
  border:1px solid var(--border);
  overflow:hidden;
}
.progressFill{
  height:100%;
  background:var(--progress-fill);
}

.resultSummary .scoreBig{
  font-size:34px;
  font-weight:1000;
}
.analysis{
  white-space:pre-wrap;
  margin:0;
  font-size:13px;
  color:var(--text);
  line-height:1.5;
}

.canvas{
  width:100%;
  height:260px;
  border:1px solid var(--border);
  border-radius:14px;
  background:var(--surface);
}

.gridMini{
  display:grid;
  grid-template-columns: repeat(5, 1fr);
  gap:10px;
}
@media (max-width:820px){
  .gridMini{grid-template-columns: repeat(2, 1fr)}
}

.cardMini{
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px;
  background:var(--surface);
}
.cardMini .k{font-weight:900}
.cardMini .v{font-weight:900;margin-top:4px}
.miniBtns{display:flex;gap:8px;flex-wrap:wrap}
.mini{
  border:1px solid var(--border);
  background:var(--surface);
  border-radius:12px;
  padding:8px 10px;
  font-weight:900;
  cursor:pointer;
}

/* ★追加：解説番号の状態別（正解/不正解/未回答） */
.mini.ok{
  border-color: rgba(16,185,129,0.35);
  background: rgba(16,185,129,0.10);
  color: #047857;
}
.mini.ng{
  border-color: rgba(180,35,24,0.35);
  background: rgba(180,35,24,0.08);
  color: var(--danger);
}
.mini.na{
  border-color: var(--mini-na-border);
  background: var(--mini-na-bg);
  color: var(--mini-na-text);
}

/* ★追加：表示中（active） */
.mini.active{
  outline: 3px solid rgba(31,95,184,0.22);
  border-color: rgba(31,95,184,0.35);
}

.explainBox{
  margin-top:12px;
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px;
  background:var(--surface);
}
.exTitle{font-weight:1000;margin-bottom:8px}
.exQ{font-weight:800;margin-bottom:10px}
.exRow{margin:6px 0}
.tag{
  display:inline-block;
  padding:5px 10px;
  border-radius:999px;
  border:1px solid var(--border);
  font-weight:900;
  background:var(--surface);
}
.tag.ok{border-color:rgba(16,185,129,0.25); color:#047857}
.tag.ng{border-color:rgba(180,35,24,0.25); color:var(--danger)}

.historyStats{margin-bottom:12px}
.historyList{display:flex;flex-direction:column;gap:10px}
.historyRow{
  border:1px solid var(--border);
  border-radius:14px;
  padding:10px;
  display:flex;
  gap:10px;
  align-items:center;
}
.hL{width:32px;height:32px;border-radius:12px;display:grid;place-items:center;background:var(--surface-alt);border:1px solid var(--border);font-weight:1000}
.hTop{font-weight:900}

/* 問題内テーブル */
.qTableWrap { overflow-x: auto; }
.qTable {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}
.qTable caption {
  text-align: left;
  font-weight: 600;
  margin-bottom: 6px;
}
.qTable th, .qTable td {
  border: 1px solid var(--table-border);
  padding: 8px 10px;
  vertical-align: top;
}
.qTable th {
  background: var(--table-head);
  font-weight: 600;
}
.exTable { margin-top: 10px; }
